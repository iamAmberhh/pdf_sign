{"version":3,"sources":["all.js"],"names":["footer","document","querySelector","window","location","pathname","classList","add","timeline","querySelectorAll","pages","timelineCheck","forEach","item","index","p","firstChild","nextSibling","span","lastElementChild","remove","tag","addEventListener","e","currentTag","target","closest","tags","tagsBlock","i","getAttribute","dataset","data","dropbox","dragenter","dragover","drop","stopPropagation","preventDefault","dt","dataTransfer","files","fileObj","handleFiles","name","split","notFileAlert","bootstrap","Modal","show","size","fileSizeOver","length","fileReader","FileReader","readAsArrayBuffer","result","typedarray","Uint8Array","obj","year","lastModifiedDate","getFullYear","month","getMonth","date","getDate","push","noUpload","fileTable","renderUpload","uploadSuccess","fileUploader","reader","result2","readAsText","fileTableBody","str","innerHTML","nextStepBtn","fileName","uploadBlock","signBlock","allFiles","console","log","textContent","file","signCanvas","getPointPosition","canvaSize","getBoundingClientRect","type","x","clientX","left","y","clientY","top","touches","startPosition","isPainting","finishedPosition","signCtx","beginPath","draw","paintPosition","lineTo","stroke","save","signImg","parentElement","newImg","toDataURL","src","localStorage","setItem","back","lastDraw","Image","step","reset","historyStep","onload","clearRect","width","height","drawImage","getContext","saveBtn","backBtn","clearBtn","lineWidth","lineCap","Base64Prefix","pdfjsLib","GlobalWorkerOptions","workerSrc","readBlob","blob","Promise","resolve","reject","readAsDataURL","printPDF","pdfData","atob","substring","getDocument","promise","pdfDoc","getPage","pdfPage","viewport","getViewport","scale","devicePixelRatio","canvas","createElement","context","renderContext","canvasContext","renderTask","render","then","pdfToImage","fabric","scaleX","scaleY","Canvas","requestRenderAll","pdfImage","setWidth","setHeight","setBackgroundImage","renderAll","bind"],"mappings":"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","file":"all.js","sourcesContent":["const footer = document.querySelector(\".footer\");\nif (window.location.pathname == \"/pdf_sign/\" || window.location.pathname == '/pdf_sign/index.html') {\n  footer.classList.add(\"d-none\");\n}\n\n// 下bar 時間軸\nconst timeline = document.querySelectorAll(\".timeline li\");\nlet pages = 0;\nif (window.location.pathname == '/pdf_sign/upload.html') {\n  timelineCheck();\n}\n\nfunction timelineCheck() {\n  timeline.forEach((item, index) => {\n    let p = item.firstChild.nextSibling;\n    let span = item.lastElementChild;\n    if (index < pages) {\n      p.classList.remove(\"text-primary\", \"timeline-bar-current\");\n      p.classList.add(\"text-secondary\", \"timeline-bar-done\");\n      span.classList.remove(\"timeline-spot-current\");\n      span.classList.add(\"timeline-spot-done\");\n    }\n    if (index == pages) {\n      p.classList.remove(\"text-darkgray\");\n      p.classList.add(\"text-primary\");\n      span.classList.add(\"timeline-spot-current\");\n    }\n  });\n}\n\n// 上傳文件切換\nconst tag = document.querySelector(\".tag-bar\");\nif (tag) {\n  tag.addEventListener(\"click\", function (e) {\n    let currentTag = e.target.closest(\"li\");\n    let tags = document.querySelectorAll(\".tags\");\n    let tagsBlock = document.querySelectorAll(\".tags-block\");\n    tags.forEach((i) => {\n      i.classList.remove(\"tags-active\");\n    });\n    currentTag.classList.add(\"tags-active\");\n    tagsBlock.forEach((i) => {\n      i.classList.add(\"d-none\");\n      if (`#${i.getAttribute(\"id\")}` === currentTag.dataset.target) {\n        i.classList.remove(\"d-none\");\n      }\n    });\n  });\n}\n\n// 拖曳檔案上傳\nlet data = [];\nlet dropbox = document.querySelector(\".outline\");\nif (dropbox) {\n  dropbox.addEventListener(\"dragenter\", dragenter, false);\n  dropbox.addEventListener(\"dragover\", dragover, false);\n  dropbox.addEventListener(\"drop\", drop, false);\n}\n\nfunction dragenter(e) {\n  e.stopPropagation();\n  e.preventDefault();\n}\nfunction dragover(e) {\n  e.stopPropagation();\n  e.preventDefault();\n}\nfunction drop(e) {\n  e.stopPropagation();\n  e.preventDefault();\n  let dt = e.dataTransfer;\n  let files = dt.files;\n  let fileObj = files[0];\n  // console.log(files)\n  // console.log(files[0])\n  handleFiles(files, fileObj);\n}\n\nfunction handleFiles(files, fileObj) {\n  if (files[0].name.split(\".\")[1] != \"pdf\") {\n    let notFileAlert = new bootstrap.Modal(\n      document.querySelector(\"#notFileAlert\")\n    );\n    notFileAlert.show();\n    return;\n  }\n  if (files[0].size > 10485760) {\n    let fileSizeOver = new bootstrap.Modal(\n      document.querySelector(\"#fileSizeOver\")\n    );\n    fileSizeOver.show();\n    return;\n  }\n  \n  if (files.length > 0) {\n    let fileReader = new FileReader();\n    fileReader.readAsArrayBuffer(fileObj);\n\n    fileReader.addEventListener(\"load\", function () {\n      const result = fileReader.result;\n      // console.log(result)\n      const typedarray = new Uint8Array(fileReader.result);\n      // console.log(typedarray)\n    });\n    \n    let obj = {};\n    obj.name = files[0].name;\n    obj.year = files[0].lastModifiedDate.getFullYear();\n    obj.month = files[0].lastModifiedDate.getMonth() + 1;\n    obj.date = files[0].lastModifiedDate.getDate();\n    data.push(obj);\n\n    noUpload.classList.add(\"d-none\");\n    fileTable.classList.remove(\"d-none\");\n\n    // fileReader.readAsText(files[0]); // 讀取上傳的檔案\n\n    renderUpload();\n    uploadSuccess.show();\n  }\n}\n\n// 點擊上傳\nlet uploadSuccess = new bootstrap.Modal(\n  document.querySelector(\"#uploadSuccess\")\n);\nconst fileUploader = document.querySelector(\".select\");\n\nif (fileUploader) {\n  fileUploader.addEventListener(\"change\", (e) => {\n    // 副檔名檢查\n    if (fileUploader.files[0].name.split(\".\")[1] != \"pdf\") {\n      let notFileAlert = new bootstrap.Modal(\n        document.querySelector(\"#notFileAlert\")\n      );\n      notFileAlert.show();\n      return;\n    }\n    if (fileUploader.files[0].size > 10485760) {\n      let fileSizeOver = new bootstrap.Modal(\n        document.querySelector(\"#fileSizeOver\")\n      );\n      fileSizeOver.show();\n      return;\n    }\n\n\n    if (fileUploader.files.length > 0) {\n      let reader = new FileReader();\n      reader.addEventListener(\"load\", function () {\n        let result2 = reader.result;\n        const typedarray = new Uint8Array(reader.result);\n      });\n\n      let obj = {};\n      obj.name = fileUploader.files[0].name;\n      obj.year = fileUploader.files[0].lastModifiedDate.getFullYear();\n      obj.month = fileUploader.files[0].lastModifiedDate.getMonth() + 1;\n      obj.date = fileUploader.files[0].lastModifiedDate.getDate();\n      data.push(obj);\n\n      reader.readAsText(fileUploader.files[0]);\n    }\n    noUpload.classList.add(\"d-none\");\n    fileTable.classList.remove(\"d-none\");\n    renderUpload();\n    uploadSuccess.show();\n  });\n}\n\nconst fileTable = document.querySelector(\".has-file\");\nconst fileTableBody = document.querySelector(\".table-body\");\nfunction renderUpload() {\n  let str = \"\";\n\n  data.forEach((i) => {\n    str += `<tr data-upload>\n    <th scope=\"row\"><a href=\"#\" class=\"ellipsis\">${i.name}</a></th>\n    <td><a href=\"#\">${i.year}/${i.month}/${i.date}</a></td>\n    <td class=\"d-none d-md-block\"><a href=\"#\">--</a></td>\n</tr>`;\n  });\n  fileTableBody.innerHTML = str;\n}\n\nconst nextStepBtn = document.querySelector(\"[data-next]\");\nconst fileName = document.querySelector(\".file-name\");\n\nconst uploadBlock = document.querySelector(\"#upload\");\nconst signBlock = document.querySelector(\"#sign\");\n\nif (fileTableBody) {\n  fileTableBody.addEventListener(\"click\", function (e) {\n    let allFiles = document.querySelectorAll(\"[data-upload]\");\n    allFiles.forEach((i) => {\n      i.classList.remove(\"bg-light\");\n    });\n    e.target.closest(\"tr\").classList.add(\"bg-light\");\n    console.log(e.target.closest('tr').firstChild.nextSibling.firstChild.textContent\n    );\n    let file = e.target.closest('tr').firstChild.nextSibling.firstChild.textContent;\n    nextStepBtn.classList.remove(\"disabled\", \"btn-disabled\");\n    nextStepBtn.classList.add(\"btn-secondary\");\n  fileName.textContent = file;\n  });\n  \n}\nif (nextStepBtn) {\n  nextStepBtn.addEventListener(\"click\", function () {\n    uploadBlock.classList.add(\"d-none\");\n    signBlock.classList.remove(\"d-none\");\n    nextStepBtn.textContent = `創建文件`;\n    nextStepBtn.classList.add(\"disabled\", \"btn-disabled\");\n    nextStepBtn.classList.remove(\"btn-secondary\");\n    pages++\n    timelineCheck()\n  });\n}\n\nconst noUpload = document.querySelector(\".no-file\");\nif (noUpload) {\n  if (data.length == 0) {\n    noUpload.classList.remove(\"d-none\");\n    fileTable.classList.add(\"d-none\");\n  }\n}\n\n\n// 簽名\nconst signCanvas = document.querySelector(\"#sign-canvas\");\nif (signCanvas) {\n  const signCtx = signCanvas.getContext(\"2d\");\n  const signImg = document.querySelector(\".sign-img\");\n  const saveBtn = document.querySelector(\".saveBtn\");\n  const backBtn = document.querySelector(\".backBtn\");\n  const clearBtn = document.querySelector(\".clearBtn\");\n\n  // 設定線條相關數值\n  signCtx.lineWidth = 4;\n  signCtx.lineCap = \"round\";\n\n  let isPainting = false;\n\n  // 取得滑鼠or手指在畫布上的位置\n  function getPointPosition(e) {\n    const canvaSize = signCanvas.getBoundingClientRect();\n    if (e.type == \"mousemove\") {\n      return {\n        x: e.clientX - canvaSize.left,\n        y: e.clientY - canvaSize.top,\n      };\n    } else {\n      return {\n        x: e.touches[0].clientX - canvaSize.left,\n        y: e.touches[0].clientY - canvaSize.top,\n      };\n    }\n  }\n\n  // 開始繪圖時，將狀態開啟\n  function startPosition(e) {\n    e.preventDefault();\n    isPainting = true;\n  }\n\n  // 紀錄繪圖歷史\n  let step = -1;\n  let historyStep = [];\n  let push = function () {\n    step++;\n    if (step <= historyStep.length - 1) {\n      historyStep.length = step;\n    }\n    historyStep.push(signCanvas.toDataURL());\n  };\n\n  // 繪圖結束，將狀態關閉，並產生新路徑\n  function finishedPosition() {\n    isPainting = false;\n    signCtx.beginPath();\n    push();\n  }\n\n  // 繪製過程\n  function draw(e) {\n    if (!isPainting) return;\n    const paintPosition = getPointPosition(e);\n    signCtx.lineTo(paintPosition.x, paintPosition.y);\n    signCtx.stroke();\n  }\n\n  function save() {\n    signImg.parentElement.classList.remove(\"d-none\");\n    const newImg = signCanvas.toDataURL(\"image/png\");\n    signImg.src = newImg;\n    localStorage.setItem(\"img\", newImg);\n  }\n\n  function back() {\n    let lastDraw = new Image();\n    // 確定有上一步我們才回到上一步\n    if (step > 0) {\n      step--;\n    } else if (step == 0) {\n      reset();\n    }\n    // 把上一部的base64設定給圖像物件\n    lastDraw.src = historyStep[step];\n    // 把圖片載入後用畫布選染出來\n    lastDraw.onload = function () {\n      signCtx.clearRect(0, 0, signCanvas.width, signCanvas.height);\n      signCtx.drawImage(lastDraw, 0, 0);\n    };\n  }\n\n  function reset(e) {\n    signCtx.clearRect(0, 0, signCanvas.width, signCanvas.height);\n    historyStep = [];\n    step = -1;\n  }\n\n  // 電腦版\n  signCanvas.addEventListener(\"mousedown\", startPosition);\n  signCanvas.addEventListener(\"mouseup\", finishedPosition);\n  // signCanvas.addEventListener(\"mouseleave\", finishedPosition);\n  signCanvas.addEventListener(\"mousemove\", draw);\n\n  // 手機版\n  signCanvas.addEventListener(\"touchstart\", startPosition);\n  signCanvas.addEventListener(\"touchend\", finishedPosition);\n  signCanvas.addEventListener(\"touchcancel\", finishedPosition);\n  signCanvas.addEventListener(\"touchmove\", draw);\n\n  clearBtn.addEventListener(\"click\", reset);\n  backBtn.addEventListener(\"click\", back);\n  saveBtn.addEventListener(\"click\", save);\n}\n\n\n\n\n// PDF渲染成畫布\n\nconst Base64Prefix = \"data:application/pdf;base64,\";\npdfjsLib.GlobalWorkerOptions.workerSrc =\n  \"https://mozilla.github.io/pdf.js/build/pdf.worker.js\";\n\n// 使用原生 FileReader 轉檔\nfunction readBlob(blob) {\n  return new Promise((resolve, reject) => {\n    const reader = new FileReader();\n    reader.addEventListener(\"load\", () => resolve(reader.result));\n    reader.addEventListener(\"error\", reject);\n    reader.readAsDataURL(blob);\n  });\n}\n\nasync function printPDF(pdfData) {\n  // 將檔案處理成 base64\n  pdfData = await readBlob(pdfData);\n\n  // 將 base64 中的前綴刪去，並進行解碼\n  const data = atob(pdfData.substring(Base64Prefix.length));\n\n  // 利用解碼的檔案，載入 PDF 檔及第一頁\n  const pdfDoc = await pdfjsLib.getDocument({ data }).promise;\n  const pdfPage = await pdfDoc.getPage(1);\n\n  // 設定尺寸及產生 canvas\n  const viewport = pdfPage.getViewport({\n  scale: window.devicePixelRatio\n  });\n  const canvas = document.createElement(\"canvas\");\n  const context = canvas.getContext(\"2d\");\n\n  // 設定 PDF 所要顯示的寬高及渲染\n  canvas.height = viewport.height;\n  canvas.width = viewport.width;\n  const renderContext = {\n    canvasContext: context,\n    viewport\n  };\n  const renderTask = pdfPage.render(renderContext);\n  return renderTask.promise.then(() => canvas);\n}\n\nasync function pdfToImage(pdfData) {\n  const scale = 1 / window.devicePixelRatio;\n  return new fabric.Image(pdfData, {\n    scaleX: scale,\n    scaleY: scale,\n  });\n}\n\n// 此處 canvas 套用 fabric.js\nconst canvas = new fabric.Canvas(\"canvas\");\n\ndocument.querySelector(\".testBtn\").addEventListener(\"change\", async (e) => {\n  canvas.requestRenderAll();\n  const pdfData = await printPDF(e.target.files[0]);\n  const pdfImage = await pdfToImage(pdfData);\n\n  canvas.setWidth(pdfImage.width / window.devicePixelRatio);\n  canvas.setHeight(pdfImage.height / window.devicePixelRatio);\n  canvas.setBackgroundImage(pdfImage, canvas.renderAll.bind(canvas));\n});"]}