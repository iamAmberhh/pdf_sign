{"version":3,"sources":["all.js"],"names":["timeline","document","querySelectorAll","pages","window","location","pathname","timelineCheck","forEach","item","index","p","firstChild","nextSibling","span","lastElementChild","classList","remove","add","tag","querySelector","addEventListener","e","currentTag","target","closest","tags","tagsBlock","i","getAttribute","dataset","data","dropbox","dragenter","dragover","drop","stopPropagation","preventDefault","dt","dataTransfer","files","fileObj","handleFiles","name","split","notFileAlert","bootstrap","Modal","show","size","fileSizeOver","length","fileReader","FileReader","readAsArrayBuffer","canvas","requestRenderAll","printPDF","pdfData","pdfToImage","pdfImage","setWidth","width","devicePixelRatio","setHeight","height","setBackgroundImage","renderAll","bind","noUpload","fileTable","uploadSuccess","nextStepBtn","fileName","textContent","fileUploader","reader","result2","result","typedarray","Uint8Array","readAsText","fileTableBody","cancelBtn","uploadBlock","signBlock","allFiles","console","log","file","asideBar","createSuccess","signCanvas","signColor","getPointPosition","canvaSize","getBoundingClientRect","type","x","clientX","left","y","clientY","top","touches","startPosition","isPainting","finishedPosition","signCtx","beginPath","push","draw","paintPosition","lineTo","stroke","save","signImg","parentElement","newImg","toDataURL","src","localStorage","setItem","back","lastDraw","Image","step","reset","historyStep","onload","clearRect","drawImage","getContext","saveBtn","backBtn","clearBtn","lineWidth","lineCap","contains","strokeStyle","Base64Prefix","pdfjsLib","GlobalWorkerOptions","workerSrc","readBlob","blob","Promise","resolve","reject","readAsDataURL","atob","substring","getDocument","promise","pdfDoc","getPage","pdfPage","viewport","getViewport","scale","createElement","context","renderContext","canvasContext","renderTask","render","then","fabric","scaleX","scaleY","Canvas","sign","getItem","fromURL","img","pdf","jsPDF","download","image","internal","pageSize","addImage"],"mappings":"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","file":"all.js","sourcesContent":["\n// 下bar 時間軸\nconst timeline = document.querySelectorAll(\".timeline li\");\nlet pages = 0;\nif (window.location.pathname == \"/pdf_sign/upload.html\") {\n  timelineCheck();\n}\n\nfunction timelineCheck() {\n  timeline.forEach((item, index) => {\n    let p = item.firstChild.nextSibling;\n    let span = item.lastElementChild;\n    if (index < pages) {\n      p.classList.remove(\"text-primary\", \"timeline-bar-current\");\n      p.classList.add(\"text-secondary\", \"timeline-bar-done\");\n      span.classList.remove(\"timeline-spot-current\");\n      span.classList.add(\"timeline-spot-done\");\n    }\n    if (index == pages) {\n      p.classList.remove(\"text-darkgray\");\n      p.classList.add(\"text-primary\");\n      span.classList.add(\"timeline-spot-current\");\n    }\n  });\n}\n\n// 上傳文件切換\nconst tag = document.querySelector(\".tag-bar\");\nif (tag) {\n  tag.addEventListener(\"click\", function (e) {\n    let currentTag = e.target.closest(\"li\");\n    let tags = document.querySelectorAll(\".tags\");\n    let tagsBlock = document.querySelectorAll(\".tags-block\");\n    tags.forEach((i) => {\n      i.classList.remove(\"tags-active\");\n    });\n    currentTag.classList.add(\"tags-active\");\n    tagsBlock.forEach((i) => {\n      i.classList.add(\"d-none\");\n      if (`#${i.getAttribute(\"id\")}` === currentTag.dataset.target) {\n        i.classList.remove(\"d-none\");\n      }\n    });\n  });\n}\n\n// 拖曳檔案上傳\nlet data = [];\nlet dropbox = document.querySelector(\".outline\");\nif (dropbox) {\n  dropbox.addEventListener(\"dragenter\", dragenter, false);\n  dropbox.addEventListener(\"dragover\", dragover, false);\n  dropbox.addEventListener(\"drop\", drop, false);\n}\n\nfunction dragenter(e) {\n  e.stopPropagation();\n  e.preventDefault();\n}\nfunction dragover(e) {\n  e.stopPropagation();\n  e.preventDefault();\n}\nfunction drop(e) {\n  e.stopPropagation();\n  e.preventDefault();\n  let dt = e.dataTransfer;\n  let files = dt.files;\n  let fileObj = files[0];\n  handleFiles(files, fileObj);\n}\n\nfunction handleFiles(files, fileObj) {\n  if (files[0].name.split(\".\")[1] != \"pdf\") {\n    let notFileAlert = new bootstrap.Modal(\n      document.querySelector(\"#notFileAlert\")\n    );\n    notFileAlert.show();\n    return;\n  }\n  if (files[0].size > 10485760) {\n    let fileSizeOver = new bootstrap.Modal(\n      document.querySelector(\"#fileSizeOver\")\n    );\n    fileSizeOver.show();\n    return;\n  }\n\n  if (files.length > 0) {\n    let fileReader = new FileReader();\n    fileReader.readAsArrayBuffer(fileObj);\n\n    fileReader.addEventListener(\"load\", async () => {\n      canvas.requestRenderAll();\n      const pdfData = await printPDF(files[0]);\n      const pdfImage = await pdfToImage(pdfData);\n\n      canvas.setWidth(pdfImage.width / window.devicePixelRatio);\n      canvas.setHeight(pdfImage.height / window.devicePixelRatio);\n      canvas.setBackgroundImage(pdfImage, canvas.renderAll.bind(canvas));\n    });\n\n    // let obj = {};\n    // obj.name = files[0].name;\n    // obj.year = files[0].lastModifiedDate.getFullYear();\n    // obj.month = files[0].lastModifiedDate.getMonth() + 1;\n    // obj.date = files[0].lastModifiedDate.getDate();\n    // data.push(obj);\n\n    noUpload.classList.add(\"d-none\");\n    fileTable.classList.remove(\"d-none\");\n\n    // fileReader.readAsText(files[0]); // 讀取上傳的檔案\n    // renderUpload();\n    uploadSuccess.show();\n    nextStepBtn[0].classList.remove(\"disabled\", \"btn-disabled\");\n    nextStepBtn[0].classList.add(\"btn-secondary\");\n    fileName.textContent = files[0].name;\n  }\n}\n\n// 點擊上傳\nlet uploadSuccess = new bootstrap.Modal(\n  document.querySelector(\"#uploadSuccess\")\n);\nconst fileUploader = document.querySelector(\".select\");\n\nif (fileUploader) {\n    \n  fileUploader.addEventListener(\"change\", (e) => {\n    // 副檔名檢查\n    if (fileUploader.files[0].name.split(\".\")[1] != \"pdf\") {\n      let notFileAlert = new bootstrap.Modal(\n        document.querySelector(\"#notFileAlert\")\n      );\n      notFileAlert.show();\n      return;\n    }\n    if (fileUploader.files[0].size > 10485760) {\n      let fileSizeOver = new bootstrap.Modal(\n        document.querySelector(\"#fileSizeOver\")\n      );\n      fileSizeOver.show();\n      return;\n    }\n\n    if (fileUploader.files.length > 0) {\n      let reader = new FileReader();\n      reader.addEventListener(\"load\", function () {\n        let result2 = reader.result;\n        const typedarray = new Uint8Array(reader.result);\n      });\n\n      //   let obj = {};\n      //   obj.name = fileUploader.files[0].name;\n      //   obj.year = fileUploader.files[0].lastModifiedDate.getFullYear();\n      //   obj.month = fileUploader.files[0].lastModifiedDate.getMonth() + 1;\n      //   obj.date = fileUploader.files[0].lastModifiedDate.getDate();\n      //   data.push(obj);\n\n      reader.readAsText(fileUploader.files[0]);\n    }\n    noUpload.classList.add(\"d-none\");\n    fileTable.classList.remove(\"d-none\");\n    // renderUpload();\n    uploadSuccess.show();\n    nextStepBtn[0].classList.remove(\"disabled\", \"btn-disabled\");\n    nextStepBtn[0].classList.add(\"btn-secondary\");\n    fileName.textContent = fileUploader.files[0].name;\n  });\n}\n\nconst fileTable = document.querySelector(\".has-file\");\nconst fileTableBody = document.querySelector(\".table-body\");\n// function renderUpload() {\n//   let str = \"\";\n\n//   data.forEach((i) => {\n//     str += `<tr data-upload>\n//     <th scope=\"row\"><a href=\"#\" class=\"ellipsis\">${i.name}</a></th>\n//     <td><a href=\"#\">${i.year}/${i.month}/${i.date}</a></td>\n//     <td class=\"d-none d-md-block\"><a href=\"#\">--</a></td>\n// </tr>`;\n//   });\n//   fileTableBody.innerHTML = str;\n// }\n\nconst nextStepBtn = document.querySelectorAll(\"[data-next]\");\nconst cancelBtn = document.querySelector(\"[data-cancel]\");\nconst fileName = document.querySelector(\".file-name\");\n\nconst uploadBlock = document.querySelector(\"#upload\");\nconst signBlock = document.querySelector(\"#sign\");\n\nif (fileTableBody) {\n  fileTableBody.addEventListener(\"click\", function (e) {\n    let allFiles = document.querySelectorAll(\"[data-upload]\");\n    allFiles.forEach((i) => {\n      i.classList.remove(\"bg-light\");\n    });\n    e.target.closest(\"tr\").classList.add(\"bg-light\");\n    console.log(\n      e.target.closest(\"tr\").firstChild.nextSibling.firstChild.textContent\n    );\n    let file =\n      e.target.closest(\"tr\").firstChild.nextSibling.firstChild.textContent;\n    nextStepBtn[0].classList.remove(\"disabled\", \"btn-disabled\");\n    nextStepBtn[0].classList.add(\"btn-secondary\");\n    fileName.textContent = file;\n  });\n}\nconst asideBar = document.querySelector('.aside-bar');\n// 步驟推進\nif (nextStepBtn) {\n  nextStepBtn[0].addEventListener(\"click\", function (e) {\n    uploadBlock.classList.add(\"d-none\");\n    signBlock.classList.remove(\"d-none\");\n    nextStepBtn[0].classList.add(\"d-none\");\n    nextStepBtn[1].classList.remove(\"d-none\");\n    pages++;\n    timelineCheck();\n  });\n  nextStepBtn[1].addEventListener(\"click\", function (e) {\n    let createSuccess = new bootstrap.Modal(\n      document.querySelector(\"#createSuccess\")\n    );\n    createSuccess.show();\n    nextStepBtn[1].classList.add(\"d-none\");\n    nextStepBtn[2].classList.remove(\"d-none\");\n    asideBar.classList.add(\"d-none\");\n    nextStepBtn[2].classList.remove(\"disabled\", \"btn-disabled\");\n    nextStepBtn[2].classList.add(\"btn-secondary\");\n    cancelBtn.textContent = \"回首頁\";\n    pages++;\n    timelineCheck();\n  });\n}\n\nconst noUpload = document.querySelector(\".no-file\");\nif (noUpload) {\n  if (data.length == 0) {\n    noUpload.classList.remove(\"d-none\");\n    fileTable.classList.add(\"d-none\");\n  }\n}\n\n// 簽名\nconst signCanvas = document.querySelector(\"#sign-canvas\");\nconst signColor = document.querySelectorAll('.sign-color');\nif (signCanvas) {\n  const signCtx = signCanvas.getContext(\"2d\");\n  const signImg = document.querySelector(\".sign-img\");\n  const saveBtn = document.querySelector(\".saveBtn\");\n  const backBtn = document.querySelector(\".backBtn\");\n  const clearBtn = document.querySelector(\".clearBtn\");\n\n  // 設定線條相關數值\n  signCtx.lineWidth = 4;\n  signCtx.lineCap = \"round\";\n  signColor.forEach(i=>{\n    i.addEventListener('click',function(e){\n      if(e.target.classList.contains('sign-color-red')){\n        signCtx.strokeStyle = \"red\";\n      }else if(e.target.classList.contains('sign-color-blue')){\n        signCtx.strokeStyle = \"blue\";\n      }else if(e.target.classList.contains('sign-color-black')){\n        signCtx.strokeStyle = \"black\";\n      }\n    })\n  })\n\n  let isPainting = false;\n\n  // 取得滑鼠or手指在畫布上的位置\n  function getPointPosition(e) {\n    const canvaSize = signCanvas.getBoundingClientRect();\n    if (e.type == \"mousemove\") {\n      return {\n        x: e.clientX - canvaSize.left,\n        y: e.clientY - canvaSize.top,\n      };\n    } else {\n      return {\n        x: e.touches[0].clientX - canvaSize.left,\n        y: e.touches[0].clientY - canvaSize.top,\n      };\n    }\n  }\n\n  // 開始繪圖時，將狀態開啟\n  function startPosition(e) {\n    e.preventDefault();\n    isPainting = true;\n  }\n\n  // 紀錄繪圖歷史\n  let step = -1;\n  let historyStep = [];\n  let push = function () {\n    step++;\n    if (step <= historyStep.length - 1) {\n      historyStep.length = step;\n    }\n    historyStep.push(signCanvas.toDataURL());\n  };\n\n  // 繪圖結束，將狀態關閉，並產生新路徑\n  function finishedPosition() {\n    isPainting = false;\n    signCtx.beginPath();\n    push();\n  }\n\n  // 繪製過程\n  function draw(e) {\n    if (!isPainting) return;\n    const paintPosition = getPointPosition(e);\n    signCtx.lineTo(paintPosition.x, paintPosition.y);\n    signCtx.stroke();\n  }\n\n  function save() {\n    signImg.parentElement.classList.remove(\"d-none\");\n    const newImg = signCanvas.toDataURL(\"image/png\");\n    signImg.src = newImg;\n    localStorage.setItem(\"img\", newImg);\n  }\n\n  function back() {\n    let lastDraw = new Image();\n    // 確定有上一步我們才回到上一步\n    if (step > 0) {\n      step--;\n    } else if (step == 0) {\n      reset();\n    }\n    // 把上一部的base64設定給圖像物件\n    lastDraw.src = historyStep[step];\n    // 把圖片載入後用畫布選染出來\n    lastDraw.onload = function () {\n      signCtx.clearRect(0, 0, signCanvas.width, signCanvas.height);\n      signCtx.drawImage(lastDraw, 0, 0);\n    };\n  }\n\n  function reset(e) {\n    signCtx.clearRect(0, 0, signCanvas.width, signCanvas.height);\n    historyStep = [];\n    step = -1;\n  }\n\n  // 電腦版\n  signCanvas.addEventListener(\"mousedown\", startPosition);\n  signCanvas.addEventListener(\"mouseup\", finishedPosition);\n  // signCanvas.addEventListener(\"mouseleave\", finishedPosition);\n  signCanvas.addEventListener(\"mousemove\", draw);\n\n  // 手機版\n  signCanvas.addEventListener(\"touchstart\", startPosition);\n  signCanvas.addEventListener(\"touchend\", finishedPosition);\n  signCanvas.addEventListener(\"touchcancel\", finishedPosition);\n  signCanvas.addEventListener(\"touchmove\", draw);\n\n  clearBtn.addEventListener(\"click\", reset);\n  backBtn.addEventListener(\"click\", back);\n  saveBtn.addEventListener(\"click\", save);\n}\n\n// PDF渲染成畫布\nconst Base64Prefix = \"data:application/pdf;base64,\";\nvar pdfjsLib = window[\"pdfjs-dist/build/pdf\"];\n\npdfjsLib.GlobalWorkerOptions.workerSrc =\n  \"//mozilla.github.io/pdf.js/build/pdf.worker.js\";\n\n// 使用原生 FileReader 轉檔\nfunction readBlob(blob) {\n  return new Promise((resolve, reject) => {\n    const reader = new FileReader();\n    reader.addEventListener(\"load\", () => resolve(reader.result));\n    reader.addEventListener(\"error\", reject);\n    reader.readAsDataURL(blob);\n  });\n}\n\nasync function printPDF(pdfData) {\n  // 將檔案處理成 base64\n  pdfData = await readBlob(pdfData);\n\n  // 將 base64 中的前綴刪去，並進行解碼\n  const data = atob(pdfData.substring(Base64Prefix.length));\n\n  // 利用解碼的檔案，載入 PDF 檔及第一頁\n  const pdfDoc = await pdfjsLib.getDocument({ data }).promise;\n  const pdfPage = await pdfDoc.getPage(1);\n\n  // 設定尺寸及產生 canvas\n  const viewport = pdfPage.getViewport({\n    scale: window.devicePixelRatio,\n  });\n  const canvas = document.createElement(\"canvas\");\n  const context = canvas.getContext(\"2d\");\n\n  // 設定 PDF 所要顯示的寬高及渲染\n  canvas.height = viewport.height;\n  canvas.width = viewport.width;\n  const renderContext = {\n    canvasContext: context,\n    viewport,\n  };\n  const renderTask = pdfPage.render(renderContext);\n  return renderTask.promise.then(() => canvas);\n}\n\nasync function pdfToImage(pdfData) {\n  const scale = 1 / window.devicePixelRatio;\n  return new fabric.Image(pdfData, {\n    scaleX: scale,\n    scaleY: scale,\n  });\n}\n\n// 此處 canvas 套用 fabric.js\nconst canvas = new fabric.Canvas(\"canvas\");\nfileUploader.addEventListener(\"change\", async (e) => {\n  canvas.requestRenderAll();\n  const pdfData = await printPDF(e.target.files[0]);\n  const pdfImage = await pdfToImage(pdfData);\n\n  canvas.setWidth(pdfImage.width / window.devicePixelRatio);\n  canvas.setHeight(pdfImage.height / window.devicePixelRatio);\n  canvas.setBackgroundImage(pdfImage, canvas.renderAll.bind(canvas));\n});\n\nconst sign = document.querySelector(\".sign-img\");\nif (localStorage.getItem(\"img\")) {\n  sign.src = localStorage.getItem(\"img\");\n}\n\nsign.addEventListener(\"click\", function (e) {\n  if (!sign.src) {\n    return;\n  }\n  fabric.Image.fromURL(sign.src, function (img) {\n    img.top = 0;\n    img.scaleX = 0.5;\n    img.scaleY = 0.5;\n    canvas.add(img);\n  });\n  nextStepBtn[1].classList.remove(\"disabled\", \"btn-disabled\");\n  nextStepBtn[1].classList.add(\"btn-secondary\");\n});\n\n// 下載PDF\nlet pdf = new jsPDF();\nconst download = document.querySelector('.download');\nnextStepBtn[2].addEventListener('click',function(e){\n  const image = canvas.toDataURL(\"image/png\")\n\n  const width = pdf.internal.pageSize.width;\n  const height = pdf.internal.pageSize.height;\n  pdf.addImage(image,\"png\",0,0,width,height);\n  pdf.save(\"download.pdf\")\n})\n"]}