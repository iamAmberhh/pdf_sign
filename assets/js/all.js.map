{"version":3,"sources":["all.js"],"names":["footer","document","querySelector","window","location","pathname","classList","add","timeline","querySelectorAll","pages","timelineCheck","forEach","item","index","p","firstChild","nextSibling","span","lastElementChild","remove","tag","addEventListener","e","currentTag","target","closest","tags","tagsBlock","i","getAttribute","dataset","data","dropbox","dragenter","dragover","drop","stopPropagation","preventDefault","dt","dataTransfer","files","fileObj","handleFiles","uploadSuccess","bootstrap","Modal","name","split","notFileAlert","show","size","fileSizeOver","length","fileReader","FileReader","readAsArrayBuffer","result","typedarray","Uint8Array","obj","year","lastModifiedDate","getFullYear","month","getMonth","date","getDate","push","noUpload","fileTable","renderUpload","fileUploader","reader","result2","readAsText","fileTableBody","str","file","innerHTML","fileName","textContent","nextStepBtn","uploadBlock","signBlock","allFiles","Base64Prefix","pdfjsLib","GlobalWorkerOptions","workerSrc","readBlob","blob","Promise","resolve","reject","readAsDataURL","printPDF","pdfData","atob","substring","getDocument","promise","pdfDoc","getPage","pdfPage","viewport","getViewport","scale","devicePixelRatio","canvas","createElement","context","getContext","height","width","renderContext","canvasContext","renderTask","render","then","pdfToImage","fabric","Image","id","scaleX","scaleY","signCanvas","getPointPosition","canvaSize","getBoundingClientRect","type","x","clientX","left","y","clientY","top","touches","startPosition","isPainting","finishedPosition","signCtx","beginPath","draw","paintPosition","lineTo","stroke","save","signImg","parentElement","newImg","toDataURL","src","localStorage","setItem","back","lastDraw","step","reset","historyStep","onload","clearRect","drawImage","saveBtn","backBtn","clearBtn","lineWidth","lineCap"],"mappings":"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","file":"all.js","sourcesContent":["const footer = document.querySelector(\".footer\");\nif (window.location.pathname == \"/pdf_sign/\") {\n  footer.classList.add(\"d-none\");\n}\n\n// 下bar 時間軸\nconst timeline = document.querySelectorAll(\".timeline li\");\nlet pages = 0;\nif (window.location.pathname == \"/signup.html\") {\n  //'/pdf_sign/upload.html'\n  pages = 1;\n  timelineCheck();\n}\nif (window.location.pathname == \"/download.html\") {\n  pages = 2;\n  timelineCheck();\n}\n\nfunction timelineCheck() {\n  timeline.forEach((item, index) => {\n    let p = item.firstChild.nextSibling;\n    let span = item.lastElementChild;\n    if (index < pages) {\n      p.classList.remove(\"text-primary\", \"timeline-bar-current\");\n      p.classList.add(\"text-secondary\", \"timeline-bar-done\");\n      span.classList.remove(\"timeline-spot-current\");\n      span.classList.add(\"timeline-spot-done\");\n    }\n    if (index == pages) {\n      p.classList.remove(\"text-darkgray\");\n      p.classList.add(\"text-primary\");\n      span.classList.add(\"timeline-spot-current\");\n    }\n  });\n}\n\n// 上傳文件切換\nconst tag = document.querySelector(\".tag-bar\");\nif (tag) {\n  tag.addEventListener(\"click\", function (e) {\n    let currentTag = e.target.closest(\"li\");\n    let tags = document.querySelectorAll(\".tags\");\n    let tagsBlock = document.querySelectorAll(\".tags-block\");\n    tags.forEach((i) => {\n      i.classList.remove(\"tags-active\");\n    });\n    currentTag.classList.add(\"tags-active\");\n    tagsBlock.forEach((i) => {\n      i.classList.add(\"d-none\");\n      if (`#${i.getAttribute(\"id\")}` === currentTag.dataset.target) {\n        i.classList.remove(\"d-none\");\n      }\n    });\n  });\n}\n\n// 拖曳檔案上傳\nlet data = [];\nlet dropbox = document.querySelector(\".outline\");\nif (dropbox) {\n  dropbox.addEventListener(\"dragenter\", dragenter, false);\n  dropbox.addEventListener(\"dragover\", dragover, false);\n  dropbox.addEventListener(\"drop\", drop, false);\n}\n\nfunction dragenter(e) {\n  e.stopPropagation();\n  e.preventDefault();\n}\nfunction dragover(e) {\n  e.stopPropagation();\n  e.preventDefault();\n}\nfunction drop(e) {\n  e.stopPropagation();\n  e.preventDefault();\n  let dt = e.dataTransfer;\n  let files = dt.files;\n  let fileObj = files[0];\n  // console.log(files)\n  // console.log(files[0])\n  handleFiles(files, fileObj);\n}\n\nlet uploadSuccess = new bootstrap.Modal(\n  document.querySelector(\"#uploadSuccess\")\n);\n\n\nfunction handleFiles(files, fileObj) {\n  if (files[0].name.split(\".\")[1] != \"pdf\") {\n    let notFileAlert = new bootstrap.Modal(\n      document.querySelector(\"#notFileAlert\")\n    );\n    notFileAlert.show();\n    return;\n  }\n  if (files[0].size > 10485760) {\n    let fileSizeOver = new bootstrap.Modal(\n      document.querySelector(\"#fileSizeOver\")\n    );\n    fileSizeOver.show();\n    return;\n  }\n  \n  if (files.length > 0) {\n    let fileReader = new FileReader();\n    fileReader.readAsArrayBuffer(fileObj);\n\n    fileReader.addEventListener(\"load\", function () {\n      const result = fileReader.result;\n      // console.log(result)\n      const typedarray = new Uint8Array(fileReader.result);\n      // console.log(typedarray)\n    });\n    \n    let obj = {};\n    obj.name = files[0].name;\n    obj.year = files[0].lastModifiedDate.getFullYear();\n    obj.month = files[0].lastModifiedDate.getMonth() + 1;\n    obj.date = files[0].lastModifiedDate.getDate();\n    data.push(obj);\n\n    noUpload.classList.add(\"d-none\");\n    fileTable.classList.remove(\"d-none\");\n\n    // fileReader.readAsText(files[0]); // 讀取上傳的檔案\n\n    renderUpload();\n    uploadSuccess.show();\n  }\n}\nconst fileUploader = document.querySelector(\".select\");\n\nif (fileUploader) {\n  fileUploader.addEventListener(\"change\", (e) => {\n    // 副檔名檢查\n    if (fileUploader.files[0].name.split(\".\")[1] != \"pdf\") {\n      return;\n    }\n    if (fileUploader.files.length > 0) {\n      let reader = new FileReader();\n      reader.addEventListener(\"load\", function () {\n        let result2 = reader.result;\n        const typedarray = new Uint8Array(reader.result);\n      });\n\n      let obj = {};\n      obj.name = fileUploader.files[0].name;\n      obj.year = fileUploader.files[0].lastModifiedDate.getFullYear();\n      obj.month = fileUploader.files[0].lastModifiedDate.getMonth() + 1;\n      obj.date = fileUploader.files[0].lastModifiedDate.getDate();\n      data.push(obj);\n\n      reader.readAsText(fileUploader.files[0]);\n    }\n    noUpload.classList.add(\"d-none\");\n    fileTable.classList.remove(\"d-none\");\n    renderUpload();\n    uploadSuccess.show();\n  });\n}\n\nconst fileTable = document.querySelector(\".has-file\");\nconst fileTableBody = document.querySelector(\".table-body\");\nfunction renderUpload() {\n  let str = \"\";\n  let file = \"\";\n  data.forEach((i) => {\n    str += `<tr data-upload>\n    <th scope=\"row\"><a href=\"#\">${i.name}</a></th>\n    <td><a href=\"#\">${i.year}/${i.month}/${i.date}</a></td>\n    <td class=\"d-none d-md-block\"><a href=\"#\">--</a></td>\n</tr>`;\nfile+=`${i.name}`;\n  });\n  fileTableBody.innerHTML = str;\n  fileName.textContent = file;\n}\n\nconst nextStepBtn = document.querySelector(\"[data-next]\");\nconst fileName = document.querySelector(\".file-name\");\n\nconst uploadBlock = document.querySelector(\"#upload\");\nconst signBlock = document.querySelector(\"#sign\");\n\nif (fileTableBody) {\n  fileTableBody.addEventListener(\"click\", function (e) {\n    let allFiles = document.querySelectorAll(\"[data-upload]\");\n    allFiles.forEach((i) => {\n      i.classList.remove(\"bg-light\");\n    });\n    e.target.closest(\"tr\").classList.add(\"bg-light\");\n    nextStepBtn.classList.remove(\"disabled\", \"btn-disabled\");\n    nextStepBtn.classList.add(\"btn-secondary\");\n  });\n}\nif (nextStepBtn) {\n  nextStepBtn.addEventListener(\"click\", function () {\n    uploadBlock.classList.add(\"d-none\");\n    signBlock.classList.remove(\"d-none\");\n    nextStepBtn.textContent = `創建文件`;\n    nextStepBtn.classList.add(\"disabled\", \"btn-disabled\");\n    nextStepBtn.classList.remove(\"btn-secondary\");\n  });\n}\n\nconst noUpload = document.querySelector(\".no-file\");\nif (noUpload) {\n  if (data.length == 0) {\n    noUpload.classList.remove(\"d-none\");\n    fileTable.classList.add(\"d-none\");\n  }\n}\n\n// PDF渲染成畫布\n\n// const selectFile = document.querySelector(\".select\");\n// pdfjsLib.GlobalWorkerOptions.workerSrc = \"https://mozilla.github.io/pdf.js/build/pdf.worker.js\";\n// const canvas = document.querySelector(\"#canvas\");\n// const ctx = canvas.getContext(\"2d\");\n\n// function renderPDF(data) {\n//   //  非同步 取得PDF檔案 進到then\n//   pdfjsLib.getDocument(data).promise.then((doc) => {\n//     //  選擇檔案的第一頁，成功再進到then\n//     doc.getPage(1).then((page) => {\n//       //  取得檔案的大小，並設為視口大小\n//       const viewport = page.getViewport({ scale: 1 });\n//       //   讓畫布和視口(檔案)大小一樣\n//       canvas.width = viewport.width;\n//       canvas.height = viewport.height;\n//       //   渲染頁面\n//       page.render({\n//         canvasContext: ctx,\n//         viewport: viewport\n//       });\n//     });\n//   });\n// }\n\n// if(selectFile){\n//   selectFile.addEventListener(\"change\", (e) => {\n//     if (e.target.files[0] === undefined) return;\n//     const file = e.target.files[0];\n//     const fileReader = new FileReader();\n//     fileReader.readAsArrayBuffer(file);\n//     fileReader.addEventListener(\"load\", () => {\n//       // 獲取readAsArrayBuffer產生的結果，並用來渲染PDF\n//       const typedarray = new Uint8Array(fileReader.result);\n//       renderPDF(typedarray);\n//     });\n//   });\n// }\n\nconst Base64Prefix = \"data:application/pdf;base64,\";\nconst add = document.querySelector(\".add\");\npdfjsLib.GlobalWorkerOptions.workerSrc =\n  \"https://mozilla.github.io/pdf.js/build/pdf.worker.js\";\n\n// 使用原生 FileReader 轉檔\nfunction readBlob(blob) {\n  return new Promise((resolve, reject) => {\n    const reader = new FileReader();\n    reader.addEventListener(\"load\", () => resolve(reader.result));\n    reader.addEventListener(\"error\", reject);\n    reader.readAsDataURL(blob);\n  });\n}\n\nasync function printPDF(pdfData) {\n  // 將檔案處理成 base64\n  pdfData = await readBlob(pdfData);\n\n  // 將 base64 中的前綴刪去，並進行解碼\n  const data = atob(pdfData.substring(Base64Prefix.length));\n\n  // 利用解碼的檔案，載入 PDF 檔及第一頁\n  const pdfDoc = await pdfjsLib.getDocument({ data }).promise;\n  const pdfPage = await pdfDoc.getPage(1);\n\n  // 設定尺寸及產生 canvas\n  const viewport = pdfPage.getViewport({ scale: window.devicePixelRatio });\n  const canvas = document.createElement(\"canvas\");\n  const context = canvas.getContext(\"2d\");\n\n  // 設定 PDF 所要顯示的寬高及渲染\n  canvas.height = viewport.height;\n  canvas.width = viewport.width;\n  const renderContext = {\n    canvasContext: context,\n    viewport,\n  };\n  const renderTask = pdfPage.render(renderContext);\n\n  // 回傳做好的 PDF canvas\n  return renderTask.promise.then(() => canvas);\n}\n\nasync function pdfToImage(pdfData) {\n  // 設定 PDF 轉為圖片時的比例\n  const scale = 1 / window.devicePixelRatio;\n\n  // 回傳圖片\n  return new fabric.Image(pdfData, {\n    id: \"renderPDF\",\n    scaleX: scale,\n    scaleY: scale,\n  });\n}\n\n// 此處 canvas 套用 fabric.js\n// const canvas = new fabric.Canvas(\"canvas\");\n\n// document.querySelector(\".select\").addEventListener(\"change\", async function(e){\n//   canvas.requestRenderAll();\n//   const pdfData = await printPDF(e.target.files[0]).promise;\n//   const pdfImage = await pdfToImage(pdfData).promise;\n\n//   // 透過比例設定 canvas 尺寸\n//   canvas.setWidth(pdfImage.width / window.devicePixelRatio);\n//   canvas.setHeight(pdfImage.height / window.devicePixelRatio);\n\n//   // 將 PDF 畫面設定為背景\n//   canvas.setBackgroundImage(pdfImage, canvas.renderAll.bind(canvas));\n// });\n\n// 簽名\nconst signCanvas = document.querySelector(\"#sign-canvas\");\nif (signCanvas) {\n  const signCtx = signCanvas.getContext(\"2d\");\n  const signImg = document.querySelector(\".sign-img\");\n  const saveBtn = document.querySelector(\".saveBtn\");\n  const backBtn = document.querySelector(\".backBtn\");\n  const clearBtn = document.querySelector(\".clearBtn\");\n\n  // 設定線條相關數值\n  signCtx.lineWidth = 4;\n  signCtx.lineCap = \"round\";\n\n  let isPainting = false;\n\n  // 取得滑鼠or手指在畫布上的位置\n  function getPointPosition(e) {\n    const canvaSize = signCanvas.getBoundingClientRect();\n    if (e.type == \"mousemove\") {\n      return {\n        x: e.clientX - canvaSize.left,\n        y: e.clientY - canvaSize.top,\n      };\n    } else {\n      return {\n        x: e.touches[0].clientX - canvaSize.left,\n        y: e.touches[0].clientY - canvaSize.top,\n      };\n    }\n  }\n\n  // 開始繪圖時，將狀態開啟\n  function startPosition(e) {\n    e.preventDefault();\n    isPainting = true;\n  }\n\n  // 紀錄繪圖歷史\n  let step = -1;\n  let historyStep = [];\n  let push = function () {\n    step++;\n    if (step <= historyStep.length - 1) {\n      historyStep.length = step;\n    }\n    historyStep.push(signCanvas.toDataURL());\n  };\n\n  // 繪圖結束，將狀態關閉，並產生新路徑\n  function finishedPosition() {\n    isPainting = false;\n    signCtx.beginPath();\n    push();\n  }\n\n  // 繪製過程\n  function draw(e) {\n    if (!isPainting) return;\n    const paintPosition = getPointPosition(e);\n    signCtx.lineTo(paintPosition.x, paintPosition.y);\n    signCtx.stroke();\n  }\n\n  function save() {\n    signImg.parentElement.classList.remove(\"d-none\");\n    const newImg = signCanvas.toDataURL(\"image/png\");\n    signImg.src = newImg;\n    localStorage.setItem(\"img\", newImg);\n  }\n\n  function back() {\n    let lastDraw = new Image();\n    // 確定有上一步我們才回到上一步\n    if (step > 0) {\n      step--;\n    } else if (step == 0) {\n      reset();\n    }\n    // 把上一部的base64設定給圖像物件\n    lastDraw.src = historyStep[step];\n    // 把圖片載入後用畫布選染出來\n    lastDraw.onload = function () {\n      signCtx.clearRect(0, 0, signCanvas.width, signCanvas.height);\n      signCtx.drawImage(lastDraw, 0, 0);\n    };\n  }\n\n  function reset(e) {\n    signCtx.clearRect(0, 0, signCanvas.width, signCanvas.height);\n    historyStep = [];\n    step = -1;\n  }\n\n  // 電腦版\n  signCanvas.addEventListener(\"mousedown\", startPosition);\n  signCanvas.addEventListener(\"mouseup\", finishedPosition);\n  // signCanvas.addEventListener(\"mouseleave\", finishedPosition);\n  signCanvas.addEventListener(\"mousemove\", draw);\n\n  // 手機版\n  signCanvas.addEventListener(\"touchstart\", startPosition);\n  signCanvas.addEventListener(\"touchend\", finishedPosition);\n  signCanvas.addEventListener(\"touchcancel\", finishedPosition);\n  signCanvas.addEventListener(\"touchmove\", draw);\n\n  clearBtn.addEventListener(\"click\", reset);\n  backBtn.addEventListener(\"click\", back);\n  saveBtn.addEventListener(\"click\", save);\n}\n"]}